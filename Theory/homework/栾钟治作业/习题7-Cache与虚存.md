# 第一题

$$
10ns\times0.9+(60ns+10ns)\times0.1=16ns
$$



# 第二题

(1)	

Way：$4$ ways

Cache 组数：$\frac{64\ K\times8}{16\times8\times4}=2^{10}$ 组

主存每组块数：$\frac{4G\times8}{16\times8\times1024}=2^{18}$ 块$/$组

主存地址：$32$ 位，高 $18$ 位为组内块地址，中间 $10$ 位为组地址，低 $4$ 为块内地址

Tag：$1$ 位有效位 $+4$ 位脏位 $+18$ 位组内块地址 $=23$ 位

(2)	$(23+128)\times\frac{64\ K}{16}=75.5\ KB$ 



# 第三题

(1) $4352$ 个字可分配在 $68$ 个主存块中，Cache 的组数为 $\frac{4K}{64\times4}=16$ ，每组 $4$ 块，所以有 $64$ 块在 Cache

第一次读取时必定每个都未命中，所以有 $68$ 个块未命中，并且 Cache 内的块为 $4,5,6,\cdots,65,66,67$ 

之后的循环就会有 $20$ 块未命中，和 $48$ 块全命中

块未命中的次数：$68+20\times9=248$ 

块命中的次数：$48\times9=432$ 

若块未命中：$1$ 个字未命中，经过替换后，接下来的 $63$ 字必然命中

若块命中：$64$ 字必然命中

Cache 未命中次数：$1\times248=248$

Cache 命中次数：$63\times248+64\times432=43272$

命中率：$\frac{43272}{248+43272}=99.43\%$ 

(2)

设 Cache 访问一个字的时间为 $t$ ，则主存的访问一个字的时间为 $10t$ 
$$
加速比=\frac{10t\cdot64\cdot(248+432)}{11t\cdot248+43272t}=9.46
$$

<div style="page-break-after: always;"></div>

# 第四题

(1)	出现一次 Cache 缺失的存取时间为：$50\ ns+15\times5\ ns+2.5\ ns=127.5\ ns$

(2)	原条件的平均存取时间：$T=H\times T_C+(1-H)T_m=0.95\times2.5ns+0.05\times127.5ns=8.75ns$ 

​		 改进后出现一次 Cache 缺失的存取时间：$50ns+31\times5ns+2.5ns=207.5\ ns$ 

​		 改进后的平均存取时间：$T=H\times T_C+(1-H)T_m=0.97\times2.5ns+0.03\times207.5ns=8.65ns$ 



# 第五题

|  P   | #VPN位数 | #VPO位数 | #PPN位数 | #PPO位数 |
| :--: | :------: | :------: | :------: | :------: |
| 1KB  |    22    |    10    |    14    |    10    |
| 2KB  |    21    |    11    |    13    |    11    |
| 4KB  |    20    |    12    |    12    |    12    |
| 8KB  |    19    |    13    |    11    |    13    |

<div style="page-break-after: always;"></div>

# 第六题

(1) 页大小：$128=2^7$ ，页内偏移：$7$ 位

​	  虚拟页号：$16-7=9$ 位

​	  $4$ 组 = $2^2$ 组，组索引：$2$ 位

<table>
    <tr>
        <th align="center">7</th>
        <th align="center">2</th>
        <th align="center">7</th>
    </tr>
    <tr>
        <th align="center">TLB标记</th>
        <th align="center">TLB组索引</th>
        <th rowspan = "2", align="center">页内偏移</th>
    </tr>
    <tr>
        <th colspan = "2", align="center">虚页号</th>
    </tr>
</table>

(2)

|    5     |    7     |
| :------: | :------: |
| 物理页号 | 页内偏移 |

|     6     |      4      |    2     |
| :-------: | :---------: | :------: |
| Cache标记 | Cache行索引 | 块内地址 |

(3)

访问 $TLB$ 表，页表项在 $TLB$ 中，获取实页号，得到物理地址。

不在 $TLB$ 表，访问页表，不在页表中，就是页表缺失，说明数据不在主存，所以一定不在 Cache 中，从磁盘读取页。在页表中，生成物理地址。

根据映射规则和生成的物理地址，查找 Cache，不在 Cache 中从内存装入 Cache 再从 Cache 读出。

地址 `067AH = 0000_0110_0111_1010B` ，所以，虚页号为 `0000_0110_0B` 映射到 $TLB$ 第 `00` 组

将 `0000_011B = 03H` 与 $TLB$ 第 $0$ 组的四个标记比较，虽然和其中一个相等，但对应的有效位为 $0$ ，其余都不相等，所以 $TLB$ 缺失，需要访问主存中的页表

直接查看 `0000_0110_0B = 00CH` 处的页表项，有效位 $1$ ，取出物理页号 `19H = 1100_1B` ，和页内偏移 `111_1010B` 拼接成物理地址：`1100_1111_1010B` 

根据中间 $4$ 位 `1110` 直接找到 Cache 第 $14$ 行，有效位为 $1$ ，且标记为 `33H = 11_0011B` ，正好等于物理地址高 $6$ 位，故命中。

根据物理地址最低两位 `10` ，取出字节 $2$ 中的内容 `4H = 0100_1010B` 

<div style="page-break-after: always;"></div>

# 第七题

Cache 组数：$\frac{32KB}{256B\times8}=16=2^4$ 

主存每组块数：$\frac{2MB}{256B\times16}=512=2^9$ 

主存地址每部分的位数：$21位=\{9位组内块地址,4位组地址,8位块内地址\}$

Cache 的 Tag 的位数：$8$ 位

##### 试问在组相联映射方式下，会否出现Cache不满，但新块需启动替换才能调入的现象？

会，因为每个数据只能被写入对应的组里。